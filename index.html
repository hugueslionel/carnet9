<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liste des élèves</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #student-list li {
            margin: 5px 0;
        }
        button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <h1>Liste des élèves</h1>
    <input type="text" id="student-name" placeholder="Entrez un nom d'élève">
    <button id="add-student">Ajouter</button>
    <ul id="student-list"></ul>

    <script>
        // IndexedDB Helper Functions
        function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open("projectDB", 1);

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains("students")) {
                        db.createObjectStore("students", { keyPath: "id", autoIncrement: true });
                    }
                };

                request.onsuccess = (event) => resolve(event.target.result);
                request.onerror = (event) => reject("Erreur d'ouverture de la base IndexedDB.");
            });
        }

        function saveStudents(students) {
            return openDB().then((db) => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction("students", "readwrite");
                    const store = transaction.objectStore("students");

                    // Clear existing data
                    store.clear().onsuccess = () => {
                        // Add new data
                        students.forEach((student) => {
                            store.add({ name: student });
                        });
                        transaction.oncomplete = resolve;
                        transaction.onerror = reject;
                    };
                });
            });
        }

        function loadStudents() {
            return openDB().then((db) => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction("students", "readonly");
                    const store = transaction.objectStore("students");
                    const request = store.getAll();

                    request.onsuccess = () => resolve(request.result.map((entry) => entry.name));
                    request.onerror = reject;
                });
            });
        }

        // DOM Elements
        const studentList = document.getElementById("student-list");
        const studentNameInput = document.getElementById("student-name");
        const addStudentButton = document.getElementById("add-student");

        let students = [];

        // Add student to list
        function addStudent(name) {
            if (!name.trim()) return;
            students.push(name.trim());
            renderStudents();
            saveStudents(students).catch(console.error);
        }

        // Remove student from list
        function removeStudent(index) {
            students.splice(index, 1);
            renderStudents();
            saveStudents(students).catch(console.error);
        }

        // Render the list of students
        function renderStudents() {
            studentList.innerHTML = "";
            students.forEach((student, index) => {
                const li = document.createElement("li");
                li.textContent = student;

                const removeButton = document.createElement("button");
                removeButton.textContent = "Supprimer";
                removeButton.onclick = () => removeStudent(index);

                li.appendChild(removeButton);
                studentList.appendChild(li);
            });
        }

        // Load students on page load
        window.addEventListener("DOMContentLoaded", () => {
            loadStudents()
                .then((loadedStudents) => {
                    students = loadedStudents;
                    renderStudents();
                })
                .catch(console.error);
        });

        // Add student when clicking the button
        addStudentButton.addEventListener("click", () => {
            addStudent(studentNameInput.value);
            studentNameInput.value = "";
        });

        // Add student on Enter key press
        studentNameInput.addEventListener("keypress", (event) => {
            if (event.key === "Enter") {
                addStudent(studentNameInput.value);
                studentNameInput.value = "";
            }
        });
    </script>
</body>
</html>

